<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ApacheBench HTTP 服务器基准测试工具使用总结 | 阿拉丁的博客</title><meta name=keywords content="http"><meta name=description content="ApacheBench（ab）是用于对 Apache 超文本传输协议（HTTP）服务器进行基准测试的工具。ab 命令会创建很多的并发访问线程，模拟多个访问者同时对某一 URL 地址进行访问。它的测试目标是基于 URL 的，因此，既可以用来测试 Apache 的负载压力，也可以测试 nginx、lighthttp、tomcat、"><meta name=author content><link rel=canonical href=https://aladdinding.cn/2020/05/ApacheBench-HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/><meta name=google-site-verification content="G-QY1H3LE9QK"><link crossorigin=anonymous href=/assets/css/stylesheet.min.fcb2dfef1f861f508726aa63fad2809727c9d99081a63847ab71ee83ce0d1203.css integrity="sha256-/LLf7x+GH1CHJqpj+tKAlyfJ2ZCBpjhHq3Hug84NEgM=" rel="preload stylesheet" as=style><link rel=icon href=https://img.aladdinding.cn/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://aladdinding.cn/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://aladdinding.cn/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://aladdinding.cn/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://aladdinding.cn/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.85.0"><script async src="https://www.googletagmanager.com/gtag/js?id=G-QY1H3LE9QK"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QY1H3LE9QK')</script><meta property="og:title" content="ApacheBench HTTP 服务器基准测试工具使用总结"><meta property="og:description" content="ApacheBench（ab）是用于对 Apache 超文本传输协议（HTTP）服务器进行基准测试的工具。ab 命令会创建很多的并发访问线程，模拟多个访问者同时对某一 URL 地址进行访问。它的测试目标是基于 URL 的，因此，既可以用来测试 Apache 的负载压力，也可以测试 nginx、lighthttp、tomcat、"><meta property="og:type" content="article"><meta property="og:url" content="https://aladdinding.cn/2020/05/ApacheBench-HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-05-26T00:00:00+00:00"><meta property="article:modified_time" content="2020-05-26T00:00:00+00:00"><meta property="og:site_name" content="Aladdin"><meta name=twitter:card content="summary"><meta name=twitter:title content="ApacheBench HTTP 服务器基准测试工具使用总结"><meta name=twitter:description content="ApacheBench（ab）是用于对 Apache 超文本传输协议（HTTP）服务器进行基准测试的工具。ab 命令会创建很多的并发访问线程，模拟多个访问者同时对某一 URL 地址进行访问。它的测试目标是基于 URL 的，因此，既可以用来测试 Apache 的负载压力，也可以测试 nginx、lighthttp、tomcat、"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://aladdinding.cn/posts/"},{"@type":"ListItem","position":2,"name":"ApacheBench HTTP 服务器基准测试工具使用总结","item":"https://aladdinding.cn/2020/05/ApacheBench-HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ApacheBench HTTP 服务器基准测试工具使用总结","name":"ApacheBench HTTP 服务器基准测试工具使用总结","description":"ApacheBench（ab）是用于对 Apache 超文本传输协议（HTTP）服务器进行基准测试的工具。ab 命令会创建很多的并发访问线程，模拟多个访问者同时对某一 URL 地址进行访问。它的测试目标是基于 URL 的，因此，既可以用来测试 Apache 的负载压力，也可以测试 nginx、lighthttp、tomcat、","keywords":["http"],"articleBody":" ApacheBench（ab）是用于对 Apache 超文本传输协议（HTTP）服务器进行基准测试的工具。ab 命令会创建很多的并发访问线程，模拟多个访问者同时对某一 URL 地址进行访问。它的测试目标是基于 URL 的，因此，既可以用来测试 Apache 的负载压力，也可以测试 nginx、lighthttp、tomcat、IIS 等其它 Web 服务器的压力。ab 命令对发出负载的计算机要求很低，既不会占用很高 CPU，也不会占用很多内存，但却会给目标服务器造成巨大的负载，其原理类似 CC 攻击。自己测试使用也须注意，否则一次上太多的负载，可能造成目标服务器因资源耗完，严重时甚至导致死机。\n ApacheBench 安装 macOS Mac 下自带 apache，查看版本：\napachectl -v 查看 ab 版本:\nab -V Window Windows 系统 Apache：下载链接\nLinux Ubuntu\napt-get install apache2-utils CentOS\nyum -y install httpd-tools ApacheBench 使用 Options ab 压力测试工具的用法，查看：\nab -h # 或者 man ab Usage: ab [options] [http[s]://]hostname[:port]/path Options are: -n requests Number of requests to perform # 在测试会话中所执行的请求个数（本次测试总共要访问页面的次数）。默认时，仅执行一个请求。 -c concurrency Number of multiple requests to make at a time # 一次产生的请求个数（并发数）。默认是一次一个。 -t timelimit Seconds to max. to spend on benchmarking This implies -n 50000 # 测试所进行的最大秒数。其内部隐含值是 - n 50000。它可以使对服务器的测试限制在一个固定的总时间以内。默认时，没有时间限制。 -s timeout Seconds to max. wait for each response Default is 30 seconds # 套接字超时之前要等待的最大秒数。默认值为 30 秒。在 2.4.4 及更高版本中可用。 -b windowsize Size of TCP send/receive buffer, in bytes # TCP 发送 / 接收缓冲区的大小，以字节为单位。 -B address Address to bind to when making outgoing connections # 建立传出连接时要绑定的地址。 -p postfile File containing data to POST. Remember also to set -T # 包含要发布的数据的文件。记住也要设置 - T。 -u putfile File containing data to PUT. Remember also to set -T # 包含数据到 PUT 的文件。记住也要设置 - T。 -T content-type Content-type header to use for POST/PUT data, eg. 'application/x-www-form-urlencoded' Default is 'text/plain' # 用于 POST / PUT 数据的内容类型标头，例如 application/x-www-form-urlencoded。默认值为 text/plain。 -v verbosity How much troubleshooting info to print # 设置详细级别 4 上方将在标题上显示信息，3 上方将显示响应代码（404、200 等），2 上方将显示警告和信息。 -w Print out results in HTML tables # 在 HTML 表格中打印出结果。默认表是两列宽，带有白色背景。 -i Use HEAD instead of GET # 做 HEAD 请求，而不是 GET。 -x attributes String to insert as table attributes # 用作的属性的字符串 。插入属性。 -y attributes String to insert as tr attributes # 用作的属性的字符串 。 -z attributes String to insert as td or th attributes # 用作的属性的字符串 。 -C attribute Add cookie, eg. 'Apache=1234'. (repeatable) # cookie-name=value 对请求附加一个 Cookie: 行。 其典型形式是 name=value 的一个参数对。此参数可以重复，用逗号分割。 -H attribute Add Arbitrary header line, eg. 'Accept-Encoding: gzip' Inserted after all normal header lines. (repeatable) # 将额外的标头添加到请求。该参数是典型地在一个有效报头线的形式，含有一个冒号分隔的字段值对（即，\"Accept-Encoding: zip/zop;8bit\"）。 -A attribute Add Basic WWW Authentication, the attributes are a colon separated username and password. # 向服务器提供 BASIC 身份验证凭据。用户名和密码用单个: 分隔，并通过编码为 base64 的网络发送。无论服务器是否需要该字符串，都将发送该字符串（即，已发送所需的 401 身份验证）。 -P attribute Add Basic Proxy Authentication, the attributes are a colon separated username and password. # 在代理途中提供 BASIC 身份验证凭据。用户名和密码用单个: 分隔，并通过编码为 base64 的网络发送。不管代理是否需要它都将发送该字符串（即，已发送所需的 407 代理身份验证）。 -X proxy:port Proxyserver and port number to use # 使用代理服务器处理请求。 -V Print version number and exit # 显示版本号并退出。 -k Use HTTP KeepAlive feature # 启用 HTTP KeepAlive 功能，即在一个 HTTP 会话中执行多个请求。默认为 no KeepAlive。 -d Do not show percentiles served table. # 不要显示 “XX [ms] 表中的投放百分比”。（旧版支持）。 -S Do not show confidence estimators and warnings. # 当平均值和中位数相距标准偏差的一倍或两倍以上时，请勿显示中位数和标准偏差值，也不会显示警告 / 错误消息。并默认为最小值 / 平均值 / 最大值。（旧版支持）。 -q Do not show progress when doing more than 150 requests # 当处理 150 个以上的请求时，每 10％或 100 个左右的请求 ab 输出进度计数 stderr。该 -q 标志将禁止显示这些消息。 -l Accept variable document length (use this for dynamic pages) # 如果响应的长度不是恒定的，请不要报告错误。这对于动态页面很有用。在 2.4.7 及更高版本中可用。 -g filename Output collected data to gnuplot format file. # 将所有测量值写为 “gnuplot” 或 TSV（制表符单独值）文件。此文件可以轻松导入到 Gnuplot，IDL，Mathematica，Igor 甚至 Excel 等软件包中。标签位于文件的第一行。 -e filename Output CSV file with percentages served # 编写一个逗号分隔值（CSV）文件，其中包含为每个百分比（从 1％到 100％）提供该百分比请求所花费的时间（以毫秒为单位）。通常，它比 “gnuplot” 文件有用。因为结果已经 “装箱” 了。 -r Don not exit on socket receive errors. # 套接字接收错误时不退出 -m method Method name # 请求的自定义 HTTP 方法。在 2.4.10 及更高版本中可用。 -h Display usage information (this message) # 显示使用情况信息。 -I Disable TLS Server Name Indication (SNI) extension # 禁用 TLS 服务器名称指示 (SNI) 扩展 -Z ciphersuite Specify SSL/TLS cipher suite (See openssl ciphers) # 指定 SSL / TLS 密码套件（请参阅 openssl 密码） -f protocol Specify SSL/TLS protocol (SSL2, TLS1, TLS1.1, TLS1.2 or ALL) # 指定 SSL / TLS 协议（SSL2，SSL3，TLS1，TLS1.1，TLS1.2 或 ALL）。TLS1.1 和 TLS1.2 支持在 2.4.4 及更高版本中提供。 -E certfile Specify optional client certificate chain and private key # 指定可选的客户端证书链和私钥 Output 执行命令\nab -n 1000 -c 200 http://pts.aliyun.com/lite/index.htm/ 获取结果分析\n# apache 版本信息 This is ApacheBench, Version 2.3 $Revision: 1843412 $ Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/ Licensed to The Apache Software Foundation, http://www.apache.org/ Benchmarking pts.aliyun.com (be patient) Completed 100 requests Completed 200 requests Completed 300 requests Completed 400 requests Completed 500 requests Completed 600 requests Completed 700 requests Completed 800 requests Completed 900 requests Completed 1000 requests Finished 1000 requests # 请求返回 header 类型 Server Software: Tengine/Aserver # 请求 ip 或者域名 Server Hostname: pts.aliyun.com # 请求端口，当前请求为 https 所以端口为 443，请求 https 端口 80 Server Port: 80 # 从命令行字符串解析请求 URI。 Document Path: /lite/index.htm/ # 这是第一个成功返回的文档的大小（以字节为单位）。如果在测试过程中文档长度发生变化，则将响应视为错误。 Document Length: 357 bytes # 测试期间使用的并发客户端数 Concurrency Level: 200 从建立连接到最后接受完成总时间 Time taken for tests: 1.280 seconds # 完成请求数 Complete requests: 1000 # 失败请求数 Failed requests: 0 # 不在 200 系列响应代码中的响应数。如果所有响应均为 200，则不会打印此字段。 Non-2xx responses: 1000 # 从服务器接收的字节总数 Total transferred: 642000 bytes # HTML 接收字节数，减去了 Total transferred 中 HTTP 响应数据中的头信息的长度 HTML transferred: 357000 bytes # 吞吐率：每秒请求数（总请求数 / 总时间，相当于 LR 中的每秒事务数 TPS） Requests per second: 781.47 [#/sec] (mean) # 用户平均请求等待时间 Time per request: 255.928 [ms] (mean) # 服务器处理每个请求平均响应时间，mean 表示为平均值 Time per request: 1.280 [ms] (mean, across all concurrent requests) # 由公式计算得出的传输速率 totalread / 1024 / timetaken Transfer rate: 489.95 [Kbytes/sec] received # 连接消耗时间分解 Connection Times (ms) min mean[+/-sd] median max 最小值 平均值 标准差 中间值 最大值 Connect: 22 30 4.0 30 38 Processing: 22 95 164.5 34 1200 Waiting: 22 83 154.3 33 1200 Total: 46 125 163.4 66 1227 # 按完成请求的百分比，得出完成请求中花费时间最长的那一个请求的时间，也就是这些请求完成时间的最大值（毫秒） Percentage of the requests served within a certain time (ms) # 50% 请求完成时间的最大值是 66 毫秒 50% 66 66% 69 75% 71 80% 80 90% 317 # 90% 请求完成时间的最大值是 148 毫秒 95% 536 98% 744 99% 825 # // 100% 请求完成时间的最大值是 1227 毫秒（最长请求） 100% 1227 (longest request) 性能指标 1、吞吐率（Requests per second） 服务器并发处理能力的量化描述，单位是 reqs/s，指的是在某个并发用户数下单位时间内处理的请求数。某个并发用户数下单位时间内能处理的最大请求数，称之为最大吞吐率。 记住：吞吐率是基于并发用户数的。这句话代表了两个含义： a、吞吐率和并发用户数相关； b、不同的并发用户数下，吞吐率一般是不同的。 计算公式：总请求数 / 处理完成这些请求数所花费的时间，即： Request per second=Complete requests/Time taken for tests 必须要说明的是，这个数值表示当前机器的整体性能，值越大越好。\n2、并发连接数（The number of concurrent connections） 并发连接数指的是某个时刻服务器所接受的请求数目，简单的讲，就是一个会话。\n3、并发用户数（Concurrency Level） 要注意区分这个概念和并发连接数之间的区别，一个用户可能同时会产生多个会话，也即连接数。在 HTTP/1.1 下，IE7 支持两个并发连接，IE8 支持 6 个并发连接，FireFox3 支持 4 个并发连接，所以相应的，我们的并发用户数就得除以这个基数。\n4、用户平均请求等待时间（Time per request） 计算公式：处理完成所有请求数所花费的时间 /（总请求数 / 并发用户数），即：Time per request=Time taken for tests/（Complete requests/Concurrency Level）\n5、服务器平均请求等待时间（Time per request:across all concurrent requests） 计算公式：处理完成所有请求数所花费的时间 / 总请求数，即： Time taken for/testsComplete requests 可以看到，它是吞吐率的倒数。同时，它也等于用户平均请求等待时间 / 并发用户数，即： Time per request/Concurrency Level\n","wordCount":"3342","inLanguage":"zh","datePublished":"2020-05-26T00:00:00Z","dateModified":"2020-05-26T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://aladdinding.cn/2020/05/ApacheBench-HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93/"},"publisher":{"@type":"Organization","name":"阿拉丁的博客","logo":{"@type":"ImageObject","url":"https://img.aladdinding.cn/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://aladdinding.cn/ accesskey=h title="阿拉丁的博客 (Alt + H)">阿拉丁的博客</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://aladdinding.cn/archives/ title=时间轴><span>时间轴</span></a></li><li><a href=https://aladdinding.cn/categories/ title=分类><span>分类</span></a></li><li><a href=https://aladdinding.cn/tags/ title=标签><span>标签</span></a></li><li><a href=https://aladdinding.cn/search/ title="搜索 (Alt + /)" accesskey=/><span>搜索</span></a></li><li><a href=https://aladdinding.cn/about/ title=关于><span>关于</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://aladdinding.cn/>主页</a>&nbsp;»&nbsp;<a href=https://aladdinding.cn/posts/>Posts</a></div><h1 class=post-title>ApacheBench HTTP 服务器基准测试工具使用总结</h1><div class=post-meta>May 26, 2020&nbsp;·&nbsp;7 分钟</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>目录</div></summary><div class=inner><ul><li><a href=#apachebench-%e5%ae%89%e8%a3%85 aria-label="ApacheBench 安装">ApacheBench 安装</a><ul><li><a href=#macos aria-label=macOS>macOS</a></li><li><a href=#window aria-label=Window>Window</a></li><li><a href=#linux aria-label=Linux>Linux</a></li></ul></li><li><a href=#apachebench-%e4%bd%bf%e7%94%a8 aria-label="ApacheBench 使用">ApacheBench 使用</a><ul><li><a href=#options aria-label=Options>Options</a></li><li><a href=#output aria-label=Output>Output</a></li></ul></li><li><a href=#%e6%80%a7%e8%83%bd%e6%8c%87%e6%a0%87 aria-label=性能指标>性能指标</a><ul><li><a href=#1%e5%90%9e%e5%90%90%e7%8e%87requests-per-second aria-label="1、吞吐率（Requests per second）">1、吞吐率（Requests per second）</a></li><li><a href=#2%e5%b9%b6%e5%8f%91%e8%bf%9e%e6%8e%a5%e6%95%b0the-number-of-concurrent-connections aria-label="2、并发连接数（The number of concurrent connections）">2、并发连接数（The number of concurrent connections）</a></li><li><a href=#3%e5%b9%b6%e5%8f%91%e7%94%a8%e6%88%b7%e6%95%b0concurrency-level aria-label="3、并发用户数（Concurrency Level）">3、并发用户数（Concurrency Level）</a></li><li><a href=#4%e7%94%a8%e6%88%b7%e5%b9%b3%e5%9d%87%e8%af%b7%e6%b1%82%e7%ad%89%e5%be%85%e6%97%b6%e9%97%b4time-per-request aria-label="4、用户平均请求等待时间（Time per request）">4、用户平均请求等待时间（Time per request）</a></li><li><a href=#5%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%b9%b3%e5%9d%87%e8%af%b7%e6%b1%82%e7%ad%89%e5%be%85%e6%97%b6%e9%97%b4time-per-requestacross-all-concurrent-requests aria-label="5、服务器平均请求等待时间（Time per request:across all concurrent requests）">5、服务器平均请求等待时间（Time per request:across all concurrent requests）</a></li></ul></li></ul></div></details></div><div class=post-content><blockquote><p><a href=https://httpd.apache.org/docs/2.4/programs/ab.html>ApacheBench</a>（ab）是用于对 Apache 超文本传输协议（HTTP）服务器进行基准测试的工具。ab 命令会创建很多的并发访问线程，模拟多个访问者同时对某一 URL 地址进行访问。它的测试目标是基于 URL 的，因此，既可以用来测试 Apache 的负载压力，也可以测试 nginx、lighthttp、tomcat、IIS 等其它 Web 服务器的压力。ab 命令对发出负载的计算机要求很低，既不会占用很高 CPU，也不会占用很多内存，但却会给目标服务器造成巨大的负载，其原理类似 CC 攻击。自己测试使用也须注意，否则一次上太多的负载，可能造成目标服务器因资源耗完，严重时甚至导致死机。</p></blockquote><h1 id=apachebench-安装>ApacheBench 安装<a hidden class=anchor aria-hidden=true href=#apachebench-安装>#</a></h1><h2 id=macos>macOS<a hidden class=anchor aria-hidden=true href=#macos>#</a></h2><p>Mac 下自带 apache，查看版本：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apachectl -v
</code></pre></div><p>查看 ab 版本:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ab -V
</code></pre></div><h2 id=window>Window<a hidden class=anchor aria-hidden=true href=#window>#</a></h2><p>Windows 系统 Apache：<a href=https://www.apachehaus.com/cgi-bin/download.plx>下载链接</a></p><h2 id=linux>Linux<a hidden class=anchor aria-hidden=true href=#linux>#</a></h2><p>Ubuntu</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>apt-get install apache2-utils
</code></pre></div><p>CentOS</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>yum -y install httpd-tools
</code></pre></div><h1 id=apachebench-使用>ApacheBench 使用<a hidden class=anchor aria-hidden=true href=#apachebench-使用>#</a></h1><h2 id=options>Options<a hidden class=anchor aria-hidden=true href=#options>#</a></h2><p>ab 压力测试工具的用法，查看：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ab -h
<span style=color:#6272a4># 或者</span>
man ab
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Usage: ab <span style=color:#ff79c6>[</span>options<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>[</span>http<span style=color:#ff79c6>[</span>s<span style=color:#ff79c6>]</span>://<span style=color:#ff79c6>]</span>hostname<span style=color:#ff79c6>[</span>:port<span style=color:#ff79c6>]</span>/path
Options are:
    -n requests     Number of requests to perform
    <span style=color:#6272a4># 在测试会话中所执行的请求个数（本次测试总共要访问页面的次数）。默认时，仅执行一个请求。</span>
    -c concurrency  Number of multiple requests to make at a <span style=color:#8be9fd;font-style:italic>time</span>
    <span style=color:#6272a4># 一次产生的请求个数（并发数）。默认是一次一个。</span>
    -t timelimit    Seconds to max. to spend on benchmarking
                    This implies -n <span style=color:#bd93f9>50000</span>
		<span style=color:#6272a4># 测试所进行的最大秒数。其内部隐含值是 - n 50000。它可以使对服务器的测试限制在一个固定的总时间以内。默认时，没有时间限制。</span>
    -s timeout      Seconds to max. <span style=color:#8be9fd;font-style:italic>wait</span> <span style=color:#ff79c6>for</span> each response
                    Default is <span style=color:#bd93f9>30</span> seconds
    <span style=color:#6272a4># 套接字超时之前要等待的最大秒数。默认值为 30 秒。在 2.4.4 及更高版本中可用。</span>
    -b windowsize   Size of TCP send/receive buffer, in bytes
    <span style=color:#6272a4># TCP 发送 / 接收缓冲区的大小，以字节为单位。</span>
    -B address      Address to <span style=color:#8be9fd;font-style:italic>bind</span> to when making outgoing connections
    <span style=color:#6272a4># 建立传出连接时要绑定的地址。</span>
    -p postfile     File containing data to POST. Remember also to <span style=color:#8be9fd;font-style:italic>set</span> -T
    <span style=color:#6272a4># 包含要发布的数据的文件。记住也要设置 - T。</span>
    -u putfile      File containing data to PUT. Remember also to <span style=color:#8be9fd;font-style:italic>set</span> -T
    <span style=color:#6272a4># 包含数据到 PUT 的文件。记住也要设置 - T。</span>
    -T content-type Content-type header to use <span style=color:#ff79c6>for</span> POST/PUT data, eg.
                    <span style=color:#f1fa8c>&#39;application/x-www-form-urlencoded&#39;</span>
                    Default is <span style=color:#f1fa8c>&#39;text/plain&#39;</span>
    <span style=color:#6272a4># 用于 POST / PUT 数据的内容类型标头，例如 application/x-www-form-urlencoded。默认值为 text/plain。</span>
    -v verbosity    How much troubleshooting info to print
    <span style=color:#6272a4># 设置详细级别 4 上方将在标题上显示信息，3 上方将显示响应代码（404、200 等），2 上方将显示警告和信息。</span>
    -w              Print out results in HTML tables
    <span style=color:#6272a4># 在 HTML 表格中打印出结果。默认表是两列宽，带有白色背景。</span>
    -i              Use HEAD instead of GET
    <span style=color:#6272a4># 做 HEAD 请求，而不是 GET。</span>
    -x attributes   String to insert as table attributes
    <span style=color:#6272a4># 用作的属性的字符串 &lt;table&gt;。插入属性。&lt;table here &gt;</span>
    -y attributes   String to insert as tr attributes
    <span style=color:#6272a4># 用作的属性的字符串 &lt;tr&gt;。</span>
    -z attributes   String to insert as td or th attributes
    <span style=color:#6272a4># 用作的属性的字符串 &lt;td&gt;。</span>
    -C attribute    Add cookie, eg. <span style=color:#f1fa8c>&#39;Apache=1234&#39;</span>. <span style=color:#ff79c6>(</span>repeatable<span style=color:#ff79c6>)</span>
    <span style=color:#6272a4># cookie-name=value 对请求附加一个 Cookie: 行。 其典型形式是 name=value 的一个参数对。此参数可以重复，用逗号分割。</span>
    -H attribute    Add Arbitrary header line, eg. <span style=color:#f1fa8c>&#39;Accept-Encoding: gzip&#39;</span>
                    Inserted after all normal header lines. <span style=color:#ff79c6>(</span>repeatable<span style=color:#ff79c6>)</span>
    <span style=color:#6272a4># 将额外的标头添加到请求。该参数是典型地在一个有效报头线的形式，含有一个冒号分隔的字段值对（即，&#34;Accept-Encoding: zip/zop;8bit&#34;）。</span>
    -A attribute    Add Basic WWW Authentication, the attributes
                    are a colon separated username and password.
    <span style=color:#6272a4># 向服务器提供 BASIC 身份验证凭据。用户名和密码用单个: 分隔，并通过编码为 base64 的网络发送。无论服务器是否需要该字符串，都将发送该字符串（即，已发送所需的 401 身份验证）。</span>
    -P attribute    Add Basic Proxy Authentication, the attributes
                    are a colon separated username and password.
    <span style=color:#6272a4># 在代理途中提供 BASIC 身份验证凭据。用户名和密码用单个: 分隔，并通过编码为 base64 的网络发送。不管代理是否需要它都将发送该字符串（即，已发送所需的 407 代理身份验证）。</span>
    -X proxy:port   Proxyserver and port number to use
    <span style=color:#6272a4># 使用代理服务器处理请求。</span>
    -V              Print version number and <span style=color:#8be9fd;font-style:italic>exit</span>
    <span style=color:#6272a4># 显示版本号并退出。</span>
    -k              Use HTTP KeepAlive feature
    <span style=color:#6272a4># 启用 HTTP KeepAlive 功能，即在一个 HTTP 会话中执行多个请求。默认为 no KeepAlive。</span>
    -d              Do not show percentiles served table.
    <span style=color:#6272a4># 不要显示 “XX [ms] 表中的投放百分比”。（旧版支持）。</span>
    -S              Do not show confidence estimators and warnings.
    <span style=color:#6272a4># 当平均值和中位数相距标准偏差的一倍或两倍以上时，请勿显示中位数和标准偏差值，也不会显示警告 / 错误消息。并默认为最小值 / 平均值 / 最大值。（旧版支持）。</span>
    -q              Do not show progress when doing more than <span style=color:#bd93f9>150</span> requests
    <span style=color:#6272a4># 当处理 150 个以上的请求时，每 10％或 100 个左右的请求 ab 输出进度计数 stderr。该 -q 标志将禁止显示这些消息。</span>
    -l              Accept variable document length <span style=color:#ff79c6>(</span>use this <span style=color:#ff79c6>for</span> dynamic pages<span style=color:#ff79c6>)</span>
    <span style=color:#6272a4># 如果响应的长度不是恒定的，请不要报告错误。这对于动态页面很有用。在 2.4.7 及更高版本中可用。</span>
    -g filename     Output collected data to gnuplot format file.
    <span style=color:#6272a4># 将所有测量值写为 “gnuplot” 或 TSV（制表符单独值）文件。此文件可以轻松导入到 Gnuplot，IDL，Mathematica，Igor 甚至 Excel 等软件包中。标签位于文件的第一行。</span>
    -e filename     Output CSV file with percentages served
    <span style=color:#6272a4># 编写一个逗号分隔值（CSV）文件，其中包含为每个百分比（从 1％到 100％）提供该百分比请求所花费的时间（以毫秒为单位）。通常，它比 “gnuplot” 文件有用。因为结果已经 “装箱” 了。</span>
    -r              Don not <span style=color:#8be9fd;font-style:italic>exit</span> on socket receive errors.
    <span style=color:#6272a4># 套接字接收错误时不退出</span>
    -m method       Method name
    <span style=color:#6272a4># 请求的自定义 HTTP 方法。在 2.4.10 及更高版本中可用。</span>
    -h              Display usage information <span style=color:#ff79c6>(</span>this message<span style=color:#ff79c6>)</span>
    <span style=color:#6272a4># 显示使用情况信息。</span>
    -I              Disable TLS Server Name Indication <span style=color:#ff79c6>(</span>SNI<span style=color:#ff79c6>)</span> extension
    <span style=color:#6272a4># 禁用 TLS 服务器名称指示 (SNI) 扩展</span>
    -Z ciphersuite  Specify SSL/TLS cipher suite <span style=color:#ff79c6>(</span>See openssl ciphers<span style=color:#ff79c6>)</span>
    <span style=color:#6272a4># 指定 SSL / TLS 密码套件（请参阅 openssl 密码）</span>
    -f protocol     Specify SSL/TLS protocol
                    <span style=color:#ff79c6>(</span>SSL2, TLS1, TLS1.1, TLS1.2 or ALL<span style=color:#ff79c6>)</span>
    <span style=color:#6272a4># 指定 SSL / TLS 协议（SSL2，SSL3，TLS1，TLS1.1，TLS1.2 或 ALL）。TLS1.1 和 TLS1.2 支持在 2.4.4 及更高版本中提供。</span>
    -E certfile     Specify optional client certificate chain and private key
    <span style=color:#6272a4># 指定可选的客户端证书链和私钥</span>
</code></pre></div><h2 id=output>Output<a hidden class=anchor aria-hidden=true href=#output>#</a></h2><p>执行命令</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ab -n <span style=color:#bd93f9>1000</span> -c <span style=color:#bd93f9>200</span> http://pts.aliyun.com/lite/index.htm/
</code></pre></div><p>获取结果分析</p><div class=highlight><pre style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4># apache 版本信息</span>
This is ApacheBench, Version 2.3 &lt;<span style=color:#8be9fd;font-style:italic>$Revision</span>: <span style=color:#bd93f9>1843412</span> $&gt;
Copyright <span style=color:#bd93f9>1996</span> Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/
Licensed to The Apache Software Foundation, http://www.apache.org/

Benchmarking pts.aliyun.com <span style=color:#ff79c6>(</span>be patient<span style=color:#ff79c6>)</span>
Completed <span style=color:#bd93f9>100</span> requests
Completed <span style=color:#bd93f9>200</span> requests
Completed <span style=color:#bd93f9>300</span> requests
Completed <span style=color:#bd93f9>400</span> requests
Completed <span style=color:#bd93f9>500</span> requests
Completed <span style=color:#bd93f9>600</span> requests
Completed <span style=color:#bd93f9>700</span> requests
Completed <span style=color:#bd93f9>800</span> requests
Completed <span style=color:#bd93f9>900</span> requests
Completed <span style=color:#bd93f9>1000</span> requests
Finished <span style=color:#bd93f9>1000</span> requests

<span style=color:#6272a4># 请求返回 header 类型</span>
Server Software:        Tengine/Aserver
<span style=color:#6272a4># 请求 ip 或者域名</span>
Server Hostname:        pts.aliyun.com
<span style=color:#6272a4># 请求端口，当前请求为 https 所以端口为 443，请求 https 端口 80</span>
Server Port:            <span style=color:#bd93f9>80</span>

<span style=color:#6272a4># 从命令行字符串解析请求 URI。</span>
Document Path:          /lite/index.htm/
<span style=color:#6272a4># 这是第一个成功返回的文档的大小（以字节为单位）。如果在测试过程中文档长度发生变化，则将响应视为错误。</span>
Document Length:        <span style=color:#bd93f9>357</span> bytes

<span style=color:#6272a4># 测试期间使用的并发客户端数</span>
Concurrency Level:      <span style=color:#bd93f9>200</span>
从建立连接到最后接受完成总时间
Time taken <span style=color:#ff79c6>for</span> tests:   1.280 seconds
<span style=color:#6272a4># 完成请求数</span>
Complete requests:      <span style=color:#bd93f9>1000</span>
<span style=color:#6272a4># 失败请求数</span>
Failed requests:        <span style=color:#bd93f9>0</span>
<span style=color:#6272a4># 不在 200 系列响应代码中的响应数。如果所有响应均为 200，则不会打印此字段。</span>
Non-2xx responses:      <span style=color:#bd93f9>1000</span>
<span style=color:#6272a4># 从服务器接收的字节总数</span>
Total transferred:      <span style=color:#bd93f9>642000</span> bytes
<span style=color:#6272a4># HTML 接收字节数，减去了 Total transferred 中 HTTP 响应数据中的头信息的长度</span>
HTML transferred:       <span style=color:#bd93f9>357000</span> bytes
<span style=color:#6272a4># 吞吐率：每秒请求数（总请求数 / 总时间，相当于 LR 中的每秒事务数 TPS）</span>
Requests per second:    781.47 <span style=color:#ff79c6>[</span><span style=color:#6272a4>#/sec] (mean)</span>
<span style=color:#6272a4># 用户平均请求等待时间</span>
Time per request:       255.928 <span style=color:#ff79c6>[</span>ms<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>(</span>mean<span style=color:#ff79c6>)</span>
<span style=color:#6272a4># 服务器处理每个请求平均响应时间，mean 表示为平均值</span>
Time per request:       1.280 <span style=color:#ff79c6>[</span>ms<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>(</span>mean, across all concurrent requests<span style=color:#ff79c6>)</span>
<span style=color:#6272a4># 由公式计算得出的传输速率 totalread / 1024 / timetaken</span>
Transfer rate:          489.95 <span style=color:#ff79c6>[</span>Kbytes/sec<span style=color:#ff79c6>]</span> received

<span style=color:#6272a4># 连接消耗时间分解</span>
Connection Times <span style=color:#ff79c6>(</span>ms<span style=color:#ff79c6>)</span>
              min  mean<span style=color:#ff79c6>[</span>+/-sd<span style=color:#ff79c6>]</span> median   max
						最小值 平均值 标准差  中间值   最大值
Connect:       <span style=color:#bd93f9>22</span>   <span style=color:#bd93f9>30</span>   4.0     <span style=color:#bd93f9>30</span>      <span style=color:#bd93f9>38</span>
Processing:    <span style=color:#bd93f9>22</span>   <span style=color:#bd93f9>95</span> 164.5     <span style=color:#bd93f9>34</span>    <span style=color:#bd93f9>1200</span>
Waiting:       <span style=color:#bd93f9>22</span>   <span style=color:#bd93f9>83</span> 154.3     <span style=color:#bd93f9>33</span>    <span style=color:#bd93f9>1200</span>
Total:         <span style=color:#bd93f9>46</span>  <span style=color:#bd93f9>125</span> 163.4     <span style=color:#bd93f9>66</span>    <span style=color:#bd93f9>1227</span>

<span style=color:#6272a4># 按完成请求的百分比，得出完成请求中花费时间最长的那一个请求的时间，也就是这些请求完成时间的最大值（毫秒）</span>
Percentage of the requests served within a certain <span style=color:#8be9fd;font-style:italic>time</span> <span style=color:#ff79c6>(</span>ms<span style=color:#ff79c6>)</span>
	<span style=color:#6272a4># 50% 请求完成时间的最大值是 66 毫秒</span>
  50%     <span style=color:#bd93f9>66</span>
  66%     <span style=color:#bd93f9>69</span>
  75%     <span style=color:#bd93f9>71</span>
  80%     <span style=color:#bd93f9>80</span>
  90%    <span style=color:#bd93f9>317</span>
  <span style=color:#6272a4># 90% 请求完成时间的最大值是 148 毫秒</span>
  95%    <span style=color:#bd93f9>536</span>
  98%    <span style=color:#bd93f9>744</span>
  99%    <span style=color:#bd93f9>825</span>
  <span style=color:#6272a4># // 100% 请求完成时间的最大值是 1227 毫秒（最长请求）</span>
 100%   <span style=color:#bd93f9>1227</span> <span style=color:#ff79c6>(</span>longest request<span style=color:#ff79c6>)</span>
</code></pre></div><h1 id=性能指标>性能指标<a hidden class=anchor aria-hidden=true href=#性能指标>#</a></h1><h2 id=1吞吐率requests-per-second>1、吞吐率（Requests per second）<a hidden class=anchor aria-hidden=true href=#1吞吐率requests-per-second>#</a></h2><p>服务器并发处理能力的量化描述，单位是 reqs/s，指的是在某个并发用户数下单位时间内处理的请求数。某个并发用户数下单位时间内能处理的最大请求数，称之为最大吞吐率。
记住：吞吐率是基于并发用户数的。这句话代表了两个含义：
a、吞吐率和并发用户数相关；
b、不同的并发用户数下，吞吐率一般是不同的。
计算公式：总请求数 / 处理完成这些请求数所花费的时间，即：
Request per second=Complete requests/Time taken for tests
必须要说明的是，这个数值表示当前机器的整体性能，值越大越好。</p><h2 id=2并发连接数the-number-of-concurrent-connections>2、并发连接数（The number of concurrent connections）<a hidden class=anchor aria-hidden=true href=#2并发连接数the-number-of-concurrent-connections>#</a></h2><p>并发连接数指的是某个时刻服务器所接受的请求数目，简单的讲，就是一个会话。</p><h2 id=3并发用户数concurrency-level>3、并发用户数（Concurrency Level）<a hidden class=anchor aria-hidden=true href=#3并发用户数concurrency-level>#</a></h2><p>要注意区分这个概念和并发连接数之间的区别，一个用户可能同时会产生多个会话，也即连接数。在 HTTP/1.1 下，IE7 支持两个并发连接，IE8 支持 6 个并发连接，FireFox3 支持 4 个并发连接，所以相应的，我们的并发用户数就得除以这个基数。</p><h2 id=4用户平均请求等待时间time-per-request>4、用户平均请求等待时间（Time per request）<a hidden class=anchor aria-hidden=true href=#4用户平均请求等待时间time-per-request>#</a></h2><p>计算公式：处理完成所有请求数所花费的时间 /（总请求数 / 并发用户数），即：Time per request=Time taken for tests/（Complete requests/Concurrency Level）</p><h2 id=5服务器平均请求等待时间time-per-requestacross-all-concurrent-requests>5、服务器平均请求等待时间（Time per request:across all concurrent requests）<a hidden class=anchor aria-hidden=true href=#5服务器平均请求等待时间time-per-requestacross-all-concurrent-requests>#</a></h2><p>计算公式：处理完成所有请求数所花费的时间 / 总请求数，即：
Time taken for/testsComplete requests
可以看到，它是吞吐率的倒数。同时，它也等于用户平均请求等待时间 / 并发用户数，即：
Time per request/Concurrency Level</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://aladdinding.cn/tags/http/>http</a></li></ul><nav class=paginav><a class=prev href=https://aladdinding.cn/2020/07/%E9%BB%91%E8%8B%B9%E6%9E%9C%E4%B8%80%E9%94%AE%E5%BC%80%E5%90%AFHiDPI/><span class=title>« 上一页</span><br><span>黑苹果一键开启 HiDPI</span></a>
<a class=next href=https://aladdinding.cn/2020/04/%E8%AF%BB%E5%A6%82%E4%BD%95%E6%88%90%E4%B8%BA%E4%B8%80%E5%90%8D%E9%BB%91%E5%AE%A2%E6%9C%89%E6%84%9F/><span class=title>下一页 »</span><br><span>读《如何成为一名黑客》有感</span></a></nav></footer><div class="post bg-white"><script src=https://utteranc.es/client.js repo=aladdinding/aladdinding.github.io issue-term=title theme=github-light crossorigin=anonymous async></script></div></article></main><footer class=footer><span>&copy; 2021 <a href=https://aladdinding.cn/>阿拉丁的博客</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span>
<span><a href=https://beian.miit.gov.cn/ rel="noopener noreferrer" target=_blank>鄂ICP备2021016339号-1</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><script>document.querySelectorAll('pre > code').forEach(b=>{const c=b.parentNode.parentNode,a=document.createElement('button');a.classList.add('copy-code'),a.innerText='复制';function d(){a.innerText='已复制！',setTimeout(()=>{a.innerText='复制'},2e3)}a.addEventListener('click',e=>{if('clipboard'in navigator){navigator.clipboard.writeText(b.textContent),d();return}const a=document.createRange();a.selectNodeContents(b);const c=window.getSelection();c.removeAllRanges(),c.addRange(a);try{document.execCommand('copy'),d()}catch(a){}c.removeRange(a)}),c.classList.contains("highlight")?c.appendChild(a):c.parentNode.firstChild==c||(b.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?b.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(a):b.parentNode.appendChild(a))})</script></body></html>